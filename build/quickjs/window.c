/*
 * Copyright 2025 Neosurf Contributors
 *
 * This file is part of NeoSurf, http://www.netsurf-browser.org/
 *
 * Generated by qjs_binding_generator.py - DO NOT EDIT MANUALLY
 *
 * NeoSurf is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; version 2 of the License.
 */

/**
 * \file
 * QuickJS-ng Window interface binding.
 */

#include <stdbool.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

#include <neosurf/browser_window.h>
#include <neosurf/utils/errors.h>
#include <neosurf/utils/log.h>
#include <nsutils/time.h>

#include "quickjs.h"

/* Forward declarations */

/* Window private data */
typedef struct {
    void *private_ptr;
} WindowPrivate;

/* Class ID for Window */
static JSClassID js_window_class_id;


/* Window class finalizer */
static void js_window_finalizer(JSRuntime *rt, JSValue val)
{
    WindowPrivate *priv = JS_GetOpaque(val, js_window_class_id);
    if (priv) {
        free(priv);
    }
}

/* Window class definition */
static JSClassDef js_window_class = {
    "Window",
    .finalizer = js_window_finalizer,
};

/* Window method list */
static const JSCFunctionListEntry js_window_proto_funcs[] = {};

/**
 * Initialize Window class and properties.
 */
int qjs_init_window(JSContext *ctx)
{
    JSValue proto;
    JSValue obj;
    WindowPrivate *priv;
    JSRuntime *rt = JS_GetRuntime(ctx);

    if (js_window_class_id == 0) {
        JS_NewClassID(rt, &js_window_class_id);
    }

    if (JS_NewClass(rt, js_window_class_id, &js_window_class) < 0) {
        return -1;
    }

    proto = JS_NewObject(ctx);
    JS_SetPropertyFunctionList(
        ctx, proto, js_window_proto_funcs, sizeof(js_window_proto_funcs) / sizeof(js_window_proto_funcs[0]));

    JS_SetClassProto(ctx, js_window_class_id, proto);

    /* Specific initialization for global objects like Window */
    if (strcmp("Window", "Window") == 0) {
        JSValue global_obj = JS_GetGlobalObject(ctx);
        /*
         * For Window, we mixin our prototype into the global object
         * or define properties on it.
         * For now, simpler approach: Copy functions to global object
         */
        JS_SetPropertyFunctionList(
            ctx, global_obj, js_window_proto_funcs, sizeof(js_window_proto_funcs) / sizeof(js_window_proto_funcs[0]));

        /* Set self-references */
        JS_SetPropertyStr(ctx, global_obj, "window", JS_DupValue(ctx, global_obj));
        JS_SetPropertyStr(ctx, global_obj, "self", JS_DupValue(ctx, global_obj));

        JS_FreeValue(ctx, global_obj);
    }

    return 0;
}
